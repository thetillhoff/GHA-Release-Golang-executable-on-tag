name: Release prerequisites

inputs:
  GITHUB_TOKEN:
    description: "Token that is allowed to delete tags"
    required: true
  CHANGELOG_FILE:
    description: "Location of the file that contains the changelog"
    required: false
    default: "CHANGELOG.md"

permissions:
  contents: write

runs:
  using: "composite"
  steps:
    - name: Checkout
      uses: actions/checkout@v3
      with:
        ref: "${{ github.ref_name }}"

    - name: Check whether the release-tag is mentioned in changelog
      shell: bash
      run: |
        grep "${{ github.ref_name }}" ${{ inputs.CHANGELOG_FILE }}

    - name: Delete version-tag when changelog doesn't contain information about it
      if: failure()
      shell: bash
      run: |
        git config --global user.name 'GithubActions'
        git config --global user.email 'githubactions@users.noreply.github.com'
        git push --delete origin ${{ github.ref_name }}
